#cloud-config

write_files:
- path: /etc/systemd/system/mongodb.service
  permissions: 0644
  content: |
    [Unit]
    Description=MongoDB Container
    After=docker.service
    Requires=docker.service
    
    [Service]
    ExecStartPre=/usr/bin/docker pull mongo:6
    ExecStart=/usr/bin/docker run --rm -p 27017:27017 -v mongodb_data:/data/db --name mongodb mongo:6
    ExecStop=/usr/bin/docker stop mongodb
    Restart=always
    
    [Install]
    WantedBy=multi-user.target

runcmd:
- systemctl daemon-reload
- systemctl enable mongodb.service
- systemctl start mongodb.service